@model IndexViewModel
@using TwitterClone.Entity;

@* orta kısım *@
<div class="center-flex-container flex-item">
    <div class="home">
        <h1>Home</h1>
        <i class="fas fa-magic"></i>
    </div>

    <div class="post-tweet">
        <form action="/Post/Create" method="Post">
            <div class="form-group-1">
                <img src="~/img/yeniuye.png" alt="profile-pics">
                <input type="text" name="Content" placeholder="What's happening?">
            </div>
            <div class="form-group-2">
                <div class="post-icons">
                    <i class="far fa-image"></i>
                    <i class="far fa-file-image"></i>
                    <i class="fas fa-stream"></i>
                    <i class="far fa-smile"></i>
                    <i class="far fa-calendar-check"></i>
                </div>
                <button class="btn" type="submit">Tweet</button>
            </div>
        </form>

    </div>
    <!-- User Content -->
    @if (Model != null && Model.Posts.Any())
    {
        foreach (var post in Model.Posts)
        {
            <div class="tweets">
                <div class="user-pics">
                    <img src="~/img/yeniuye.png" alt="@(post.User?.Username ?? "Anonymous")">
                </div>
                <div class="user-content-box">
                    <div class="user-names">
                        <h1 class="full-name">
                            @if (post.User != null)
                            {
                                <a asp-controller="User" asp-action="Profile" asp-route-username="@post.User.Username">
                                    @post.User.Username
                                </a>
                            }
                            else
                            {
                                @:Anonymous
                            }
                        </h1>
                        <p class="time">@post.PostedOn.ToString("g")</p>
                    </div>
                    <div class="user-content">
                        <p>@post.Content</p>
                    </div>
                    <!-- Post altındaki ikonlar -->
                    <div class="content-icons">
                        <!-- Retweet butonu ve sayacı -->
                        <form action="@Url.Action("Retweet", "Post", new { postId = post.Id })" method="post">
                            @Html.AntiForgeryToken()
                            <button type="submit" class="retweet-button">
                                <i class="fas fa-retweet green"> @post.RePosts</i>
                            </button>
                        </form>
                        <!-- Diğer ikonlar -->
                    </div>
                    <div class="content-icons">
                        <!-- Retweet butonu ve sayacı -->
                        <form action="@Url.Action("Like", "Post", new { postId = post.Id })" method="post">
                            @Html.AntiForgeryToken()
                            <button type="submit" class="like-button">
                                <i class="far fa-heart red">@post.Likes</i>
                            </button>
                        </form>
                        <!-- Diğer ikonlar -->
                    </div>
                    
                </div>
            </div>
        }
    }
  
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

    <script>
        $(document).ready(function () {
            // Like butonuna tıklanınca
            $(".retweet-button").on("click", function (e) {
                e.preventDefault();

                // Formu serialize ederek verileri al
                var formData = $(this).closest("form").serialize();

                // Sunucuya AJAX isteği gönder
                $.ajax({
                    type: "POST",
                    url: $(this).closest("form").attr("action"),
                    data: formData,
                    success: function (result) {
                        // Sunucudan dönen sonuca göre gerekli işlemleri yapabilirsiniz
                        console.log(result);

                        // Örneğin, beğeni sayısını güncelle
                        var likeCount = parseInt($(this).find(".far.fa-heart").text());
                        $(this).find(".far.fa-heart").text(likeCount + 1);

                        // Like işlemi başarılıysa ana sayfaya yönlendir
                        window.location.href = "/Home/Index";
                    },
                    error: function (error) {
                        // Hata durumunda gerekli işlemleri yapabilirsiniz
                        console.error("Like işlemi başarısız oldu: ", error);
                    }
                });
            });
        });
    </script>


    <div class="pagnation">
        <a href="#">Load more</a>
    </div>

</div>

